<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#1a1a2e" />
    <meta
      name="description"
      content="Êô∫ËÉΩÊ±áÁéáÂÖëÊç¢Â∑•ÂÖ∑ - ÂÆûÊó∂Ê±áÁéáÊü•ËØ¢ÔºåÂéÜÂè≤Ëµ∞ÂäøÂàÜÊûêÔºåÊîØÊåÅÂ§öÁßçË¥ßÂ∏ÅÂÖëÊç¢"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <title>Êô∫ËÉΩÊ±áÁéáÂÖëÊç¢ - ÂÆûÊó∂Ê±áÁéáÊü•ËØ¢</title>
    <style>
      /* Combined CSS from App.css and index.css */
      /* Modern CSS Variables with Glassmorphism Theme */
      :root {
        /* Primary Colors - Modern Gradient Palette (Darker) */
        --primary-gradient: linear-gradient(135deg, #4a00e0 0%, #8e2de2 100%); /* Deeper purple */
        --secondary-gradient: linear-gradient(135deg, #c31432 0%, #240b36 100%); /* Darker red/purple */
        --accent-gradient: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%); /* Dark blue/green */
        --success-gradient: linear-gradient(135deg, #00467f 0%, #a5cc82 100%); /* Darker green */
        --warning-gradient: linear-gradient(135deg, #d38312 0%, #a83279 100%); /* Darker orange/pink */
        
        /* Solid Colors (Darker) */
        --primary-color: #4a00e0;
        --secondary-color: #8e2de2;
        --accent-color: #2c5364;
        --success-color: #00467f;
        --warning-color: #d38312;
        --error-color: #c0392b; /* Darker red */
        
        /* Neutral Colors (Adjusted for dark theme) */
        --white: #e0e0e0; /* Off-white for text */
        --gray-50: #2c3e50;
        --gray-100: #34495e;
        --gray-200: #4a637d;
        --gray-300: #607d8b;
        --gray-400: #78909c;
        --gray-500: #90a4ae;
        --gray-600: #b0bec5;
        --gray-700: #cfd8dc;
        --gray-800: #eceff1;
        --gray-900: #f5f5f5;
        
        /* Background Colors (Darker) */
        --bg-primary: linear-gradient(135deg, #1a2a6c 0%, #b21f1f 50%, #fdbb2d 100%); /* Darker, more vibrant gradient */
        --bg-secondary: rgba(30, 30, 30, 0.95); /* Darker secondary background */
        --bg-glass: rgba(255, 255, 255, 0.08); /* More transparent glass */
        --bg-glass-dark: rgba(255, 255, 255, 0.03); /* Even more transparent */
        --bg-overlay: rgba(0, 0, 0, 0.4); /* Darker overlay */
        
        /* Text Colors (Adjusted for dark theme) */
        --text-primary: #e0e0e0; /* Lighter text for dark background */
        --text-secondary: #b0bec5;
        --text-muted: #90a4ae;
        --text-light: #78909c;
        --text-white: #ffffff; /* Pure white for highlights */
        
        /* Shadows (Adjusted for dark theme) */
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.2);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.18);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.24);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.3);
        --shadow-glass: 0 8px 32px 0 rgba(0, 0, 0, 0.4); /* Darker glass shadow */
        
        /* Border Radius */
        --radius-sm: 0.375rem;
        --radius-md: 0.5rem;
        --radius-lg: 0.75rem;
        --radius-xl: 1rem;
        --radius-2xl: 1.5rem;
        --radius-full: 9999px;
        
        /* Spacing */
        --space-xs: 0.5rem;
        --space-sm: 0.75rem;
        --space-md: 1rem;
        --space-lg: 1.5rem;
        --space-xl: 2rem;
        --space-2xl: 3rem;
        --space-3xl: 4rem;
        
        /* Transitions */
        --transition-fast: 0.15s ease-in-out;
        --transition-normal: 0.3s ease-in-out;
        --transition-slow: 0.5s ease-in-out;
        
        /* Backdrop Blur */
        --blur-sm: blur(4px);
        --blur-md: blur(8px);
        --blur-lg: blur(16px);
        --blur-xl: blur(24px);
      }

      /* Global Styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        line-height: 1.6;
        color: var(--text-primary);
        background: #1a1a2e; /* Solid dark background */
        min-height: 100vh;
        overflow-x: hidden;
      }

      /* App Container */
      .App {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        position: relative;
      }

      /* Background Animation */
      .App::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
          radial-gradient(circle at 20% 80%, rgba(74, 0, 224, 0.1) 0%, transparent 50%), /* Darker, less opaque */
          radial-gradient(circle at 80% 20%, rgba(195, 20, 50, 0.1) 0%, transparent 50%), /* Darker, less opaque */
          radial-gradient(circle at 40% 40%, rgba(44, 83, 100, 0.1) 0%, transparent 50%); /* Darker, less opaque */
        z-index: -1;
        animation: backgroundShift 20s ease-in-out infinite;
      }

      @keyframes backgroundShift {
        0%, 100% { transform: scale(1) rotate(0deg); }
        50% { transform: scale(1.1) rotate(1deg); }
      }

      /* Header */
      .App-header {
        background: rgba(0, 0, 0, 0.2); /* Darker header background */
        backdrop-filter: var(--blur-lg);
        border: 1px solid rgba(255, 255, 255, 0.1); /* Softer border */
        padding: var(--space-xl) var(--space-lg);
        margin: var(--space-lg);
        border-radius: var(--radius-2xl);
        box-shadow: var(--shadow-glass);
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .App-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent); /* Softer shimmer */
        animation: shimmer 3s infinite;
      }

      @keyframes shimmer {
        0% { left: -100%; }
        100% { left: 100%; }
      }

      .App-header h1 {
        font-size: clamp(1.8rem, 4vw, 2.5rem);
        font-weight: 700;
        color: var(--text-primary); /* Changed to primary text color */
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5); /* Darker text shadow */
        margin: 0;
        position: relative;
        z-index: 1;
      }

      .App-header .subtitle {
        font-size: 1rem;
        color: rgba(255, 255, 255, 0.7); /* Darker subtitle color */
        margin-top: var(--space-sm);
        font-weight: 400;
      }

      /* Main Container */
      .exchange-container {
        max-width: 800px;
        margin: 0 auto var(--space-2xl);
        padding: var(--space-lg);
        display: grid;
        gap: var(--space-lg);
      }

      /* Glass Card */
      .glass-card {
        background: rgba(0, 0, 0, 0.2); /* Darker glass card background */
        backdrop-filter: var(--blur-lg);
        border: 1px solid rgba(255, 255, 255, 0.1); /* Softer border */
        border-radius: var(--radius-2xl);
        padding: var(--space-xl);
        box-shadow: var(--shadow-glass);
        transition: all var(--transition-normal);
        position: relative;
        overflow: hidden;
      }

      .glass-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 40px 0 rgba(0, 0, 0, 0.6); /* Darker hover shadow */
      }

      /* Currency Input Section */
      .currency-input-section {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        gap: var(--space-lg);
        align-items: end;
        margin-bottom: var(--space-xl);
      }

      .input-group {
        display: flex;
        flex-direction: column;
        gap: var(--space-sm);
      }

      .input-group label {
        font-weight: 600;
        color: var(--text-white);
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .input-field {
        background: rgba(0, 0, 0, 0.2); /* Darker input background */
        border: 1px solid rgba(255, 255, 255, 0.1); /* Softer border */
        border-radius: var(--radius-lg);
        padding: var(--space-md) var(--space-lg);
        font-size: 1.1rem;
        color: var(--text-white);
        transition: all var(--transition-normal);
        backdrop-filter: var(--blur-sm);
      }

      .input-field:focus {
        outline: none;
        border-color: var(--accent-color);
        box-shadow: 0 0 0 3px rgba(44, 83, 100, 0.4); /* Darker focus shadow */
        background: rgba(0, 0, 0, 0.3); /* Darker on focus */
      }

      .input-field::placeholder {
        color: rgba(255, 255, 255, 0.4); /* Darker placeholder */
      }

      /* Amount Input Special Styling */
      .amount-input {
        font-size: 1.5rem;
        font-weight: 600;
        text-align: center;
        font-family: 'JetBrains Mono', monospace;
      }

      /* Currency Select */
      .currency-select {
        background: rgba(0, 0, 0, 0.2); /* Darker select background */
        border: 1px solid rgba(255, 255, 255, 0.1); /* Softer border */
        border-radius: var(--radius-lg);
        padding: var(--space-md) var(--space-lg);
        font-size: 1rem;
        color: var(--text-white);
        cursor: pointer;
        transition: all var(--transition-normal);
        backdrop-filter: var(--blur-sm);
        min-width: 120px;
      }

      .currency-select:focus {
        outline: none;
        border-color: var(--accent-color);
        box-shadow: 0 0 0 3px rgba(44, 83, 100, 0.4); /* Darker focus shadow */
      }

      .currency-select option {
        background: var(--gray-50); /* Darker option background */
        color: var(--white);
        padding: var(--space-sm);
      }

      /* Swap Button */
      .swap-button {
        background: var(--accent-gradient); /* Using the new darker accent gradient */
        border: none;
        border-radius: var(--radius-full);
        width: 60px;
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all var(--transition-normal);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4); /* Darker shadow */
        color: var(--text-white);
        font-size: 1.2rem;
        position: relative;
        overflow: hidden;
      }

      .swap-button:hover {
        transform: rotate(180deg) scale(1.1);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.6); /* Darker hover shadow */
      }

      .swap-button:active {
        transform: rotate(180deg) scale(0.95);
      }

      .swap-button::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent); /* Softer shimmer */
        transition: left var(--transition-normal);
      }

      .swap-button:hover::before {
        left: 100%;
      }

      /* Result Display */
      .result {
        background: rgba(0, 0, 0, 0.2); /* Darker result background */
        backdrop-filter: var(--blur-lg);
        border: 1px solid rgba(255, 255, 255, 0.1); /* Softer border */
        border-radius: var(--radius-xl);
        padding: var(--space-xl);
        text-align: center;
        margin: var(--space-lg) 0;
        animation: slideInUp 0.5s ease-out;
      }

      @keyframes slideInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .result h2 {
        color: var(--text-white);
        font-size: 1.5rem;
        margin-bottom: var(--space-md);
        font-weight: 600;
      }

      .result-amount {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--text-primary); /* Changed to primary text color */
        margin: var(--space-md) 0;
        font-family: 'JetBrains Mono', monospace;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5); /* Darker text shadow */
      }

      .exchange-rate {
        color: rgba(255, 255, 255, 0.6); /* Darker exchange rate text */
        font-size: 1rem;
        margin-top: var(--space-sm);
      }

      /* Status Messages */
      .loading-message {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-sm);
        color: var(--text-white);
        font-size: 1rem;
        padding: var(--space-lg);
        background: rgba(0, 0, 0, 0.2); /* Darker loading background */
        border-radius: var(--radius-lg);
        backdrop-filter: var(--blur-md);
      }

      .loading-spinner {
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.2); /* Darker spinner border */
        border-top: 2px solid var(--text-white);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      .error-message {
        background: rgba(192, 57, 43, 0.2); /* Darker error background */
        border: 1px solid rgba(192, 57, 43, 0.4); /* Darker error border */
        color: #c0392b; /* Darker error text */
        padding: var(--space-lg);
        border-radius: var(--radius-lg);
        text-align: center;
        backdrop-filter: var(--blur-md);
        animation: shake 0.5s ease-in-out;
      }

      @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
      }

      /* Chart Container */
      .chart-container {
        background: rgba(0, 0, 0, 0.2); /* Darker chart container background */
        backdrop-filter: var(--blur-lg);
        border: 1px solid rgba(255, 255, 255, 0.1); /* Softer border */
        border-radius: var(--radius-xl);
        padding: var(--space-xl);
        margin-top: var(--space-lg);
        animation: fadeIn 0.5s ease-out;
      }

      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      /* Action Buttons */
      .action-button {
        background: var(--primary-gradient); /* Using the new darker primary gradient */
        border: none;
        border-radius: var(--radius-lg);
        padding: var(--space-md) var(--space-xl);
        color: var(--text-white);
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all var(--transition-normal);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4); /* Darker shadow */
        position: relative;
        overflow: hidden;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .action-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.6); /* Darker hover shadow */
      }

      .action-button:active {
        transform: translateY(0);
      }

      .action-button::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent); /* Softer shimmer */
        transition: left var(--transition-normal);
      }

      .action-button:hover::before {
        left: 100%;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .App-header {
          margin: var(--space-sm);
          padding: var(--space-lg);
        }
        
        .exchange-container {
          padding: var(--space-sm);
          margin-bottom: var(--space-lg);
        }
        
        .currency-input-section {
          grid-template-columns: 1fr;
          gap: var(--space-md);
          text-align: center;
        }
        
        .swap-button {
          justify-self: center;
          margin: var(--space-sm) 0;
        }
        
        .glass-card {
          padding: var(--space-lg);
        }
        
        .result-amount {
          font-size: 2rem;
        }
      }

      @media (max-width: 480px) {
        .App-header h1 {
          font-size: 1.5rem;
        }
        
        .result-amount {
          font-size: 1.8rem;
        }
        
        .currency-input-section {
          gap: var(--space-sm);
        }
        
        .glass-card {
          padding: var(--space-md);
        }
      }

      /* Accessibility */
      @media (prefers-reduced-motion: reduce) {
        * {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      /* Focus Styles for Accessibility */
      .swap-button:focus,
      .action-button:focus,
      .input-field:focus,
      .currency-select:focus {
        outline: 2px solid var(--accent-color);
        outline-offset: 2px;
      }

      /* High Contrast Mode Support */
      @media (prefers-contrast: high) {
        :root {
          --bg-glass: rgba(0, 0, 0, 0.9); /* Darker glass for high contrast */
          --text-white: #333333; /* Very dark gray for high contrast text */
        }
      }

      /* Scrollbar Styling */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.1); /* Darker scrollbar track */
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.1); /* Darker scrollbar thumb */
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.2); /* Darker scrollbar thumb on hover */
      }

      /* Selection Styling */
      ::selection {
        background: rgba(44, 83, 100, 0.3); /* Darker selection background */
        color: #ffffff;
      }
    </style>
  </head>
  <body>
    <noscript>ÊÇ®ÈúÄË¶ÅÂêØÁî® JavaScript Êù•ËøêË°åÊ≠§Â∫îÁî®Á®ãÂ∫è„ÄÇ</noscript>
    <div id="root">
      <div class="App">
        <header class="App-header">
          <h1>
            <i class="fas fa-exchange-alt" style="margin-right: 12px;"></i>
            Êô∫ËÉΩÊ±áÁéáÂÖëÊç¢
          </h1>
          <p class="subtitle">ÂÆûÊó∂Ê±áÁéáÊü•ËØ¢ ¬∑ ÂéÜÂè≤Ëµ∞ÂäøÂàÜÊûê ¬∑ Â§öÂ∏ÅÁßçÊîØÊåÅ</p>
        </header>

        <main class="exchange-container">
          <div class="glass-card">
            <div class="currency-input-section">
              <div class="input-group">
                <label for="amount">
                  <i class="fas fa-coins"></i> ÈáëÈ¢ù
                </label>
                <input
                  type="number"
                  id="amount"
                  class="input-field amount-input"
                  value="1"
                  min="0"
                  step="0.01"
                  placeholder="ËæìÂÖ•ÈáëÈ¢ù"
                />
              </div>

              <button class="swap-button" id="swap-button" title="‰∫§Êç¢Ë¥ßÂ∏Å">
                <i class="fas fa-exchange-alt"></i>
              </button>

              <div class="input-group">
                <label for="toCurrency">
                  <i class="fas fa-flag"></i> ÂÖëÊç¢‰∏∫
                </label>
                <select 
                  id="toCurrency" 
                  class="currency-select" 
                >
                </select>
              </div>
            </div>

            <div class="currency-input-section" style="grid-template-columns: 1fr; gap: var(--space-md);">
              <div class="input-group">
                <label for="fromCurrency">
                  <i class="fas fa-money-bill-wave"></i> ÂéüÂßãË¥ßÂ∏Å
                </label>
                <select 
                  id="fromCurrency" 
                  class="currency-select" 
                >
                </select>
              </div>
            </div>

            <div id="status-messages">
              <!-- Loading, error, and result messages will be inserted here by JavaScript -->
            </div>
          </div>

          <div class="glass-card" style="text-align: center;">
            <button 
              class="action-button" 
              id="toggle-chart-button"
              style="width: 100%;"
            >
              <i class="fas fa-chart-line"></i>
              ÊòæÁ§∫ÂéÜÂè≤Ëµ∞Âäø
            </button>

            <div id="chart-container" class="chart-container" style="height: 400px; margin-top: var(--space-lg); display: none;">
              <canvas id="historicalChart"></canvas>
            </div>
          </div>

          <!-- Additional Features Card -->
          <div class="glass-card">
            <h3 style="color: var(--text-white); margin-bottom: var(--space-lg); text-align: center;">
              <i class="fas fa-star"></i> Âø´ÈÄüÊìç‰Ωú
            </h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-md);">
              <button 
                class="action-button"
                id="usd-cny-button"
              >
                <i class="fas fa-dollar-sign"></i> ÁæéÂÖÉ‚Üí‰∫∫Ê∞ëÂ∏Å
              </button>
              <button 
                class="action-button"
                id="eur-cny-button"
              >
                <i class="fas fa-euro-sign"></i> Ê¨ßÂÖÉ‚Üí‰∫∫Ê∞ëÂ∏Å
              </button>
              <button 
                class="action-button"
                id="gbp-cny-button"
              >
                <i class="fas fa-pound-sign"></i> Ëã±Èïë‚Üí‰∫∫Ê∞ëÂ∏Å
              </button>
            </div>
          </div>
        </main>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      const currencyNames = {
        USD: 'ÁæéÂÖÉ (USD)',
        EUR: 'Ê¨ßÂÖÉ (EUR)',
        GBP: 'Ëã±Èïë (GBP)',
        JPY: 'Êó•ÂÖÉ (JPY)',
        CNY: '‰∫∫Ê∞ëÂ∏Å (CNY)',
        CAD: 'Âä†ÂÖÉ (CAD)',
        AUD: 'Êæ≥ÂÖÉ (AUD)',
        CHF: 'ÁëûÂ£´Ê≥ïÈÉé (CHF)',
        HKD: 'Ê∏ØÂ∏Å (HKD)',
        SGD: 'Êñ∞Âä†Âù°ÂÖÉ (SGD)',
        KRW: 'Èü©ÂÖÉ (KRW)',
        INR: 'Âç∞Â∫¶Âç¢ÊØî (INR)',
      };

      const currencyFlags = {
        USD: 'üá∫üá∏',
        EUR: 'üá™üá∫',
        GBP: 'üá¨üáß',
        JPY: 'üáØüáµ',
        CNY: 'üá®üá≥',
        CAD: 'üá®üá¶',
        AUD: 'üá¶üá∫',
        CHF: 'üá®üá≠',
        HKD: 'üá≠üá∞',
        SGD: 'üá∏üá¨',
        KRW: 'üá∞üá∑',
        INR: 'üáÆüá≥',
      };

      const currencies = Object.keys(currencyNames);

      // DOM Elements
      const amountInput = document.getElementById('amount');
      const fromCurrencySelect = document.getElementById('fromCurrency');
      const toCurrencySelect = document.getElementById('toCurrency');
      const swapButton = document.getElementById('swap-button');
      const statusMessagesDiv = document.getElementById('status-messages');
      const toggleChartButton = document.getElementById('toggle-chart-button');
      const chartContainer = document.getElementById('chart-container');
      const historicalChartCanvas = document.getElementById('historicalChart');
      const usdCnyButton = document.getElementById('usd-cny-button');
      const eurCnyButton = document.getElementById('eur-cny-button');
      const gbpCnyButton = document.getElementById('gbp-cny-button');

      let currentChart = null; // To store the Chart.js instance

      // Initial state
      let amount = 1;
      let fromCurrency = 'USD';
      let toCurrency = 'EUR';
      let exchangeRate = null;
      let convertedAmount = null;
      let error = null;
      let loading = false;
      let historicalData = null;
      let showChart = false;

      // Populate currency select options
      function populateCurrencySelects() {
        currencies.forEach(currency => {
          const optionFrom = document.createElement('option');
          optionFrom.value = currency;
          optionFrom.textContent = `${currencyFlags[currency]} ${currencyNames[currency]}`;
          fromCurrencySelect.appendChild(optionFrom);

          const optionTo = document.createElement('option');
          optionTo.value = currency;
          optionTo.textContent = `${currencyFlags[currency]} ${currencyNames[currency]}`;
          toCurrencySelect.appendChild(optionTo);
        });

        // Set initial values
        fromCurrencySelect.value = fromCurrency;
        toCurrencySelect.value = toCurrency;
      }

      // Update UI based on state
      function updateUI() {
        statusMessagesDiv.innerHTML = ''; // Clear previous messages

        if (loading) {
          statusMessagesDiv.innerHTML = `
            <div class="loading-message">
              <div class="loading-spinner"></div>
              Ê≠£Âú®Ëé∑ÂèñÊúÄÊñ∞Ê±áÁéá...
            </div>
          `;
        } else if (error) {
          statusMessagesDiv.innerHTML = `
            <div class="error-message">
              <i class="fas fa-exclamation-triangle"></i>
              ${error}
            </div>
          `;
        } else if (exchangeRate && convertedAmount !== null) {
          statusMessagesDiv.innerHTML = `
            <div class="result">
              <h2>
                <i class="fas fa-calculator"></i> ÂÖëÊç¢ÁªìÊûú
              </h2>
              <div class="result-amount">
                ${currencyFlags[fromCurrency]} ${amount} ‚Üí ${currencyFlags[toCurrency]} ${convertedAmount}
              </div>
              <div class="exchange-rate">
                ÂΩìÂâçÊ±áÁéá: 1 ${fromCurrency} = ${exchangeRate} ${toCurrency}
              </div>
              <div class="exchange-rate" style="font-size: 0.875rem; margin-top: 8px;">
                <i class="fas fa-clock"></i> Êï∞ÊçÆÊõ¥Êñ∞Êó∂Èó¥: ${new Date().toLocaleString('zh-CN')}
              </div>
            </div>
          `;
        }

        // Chart visibility
        if (showChart) {
          chartContainer.style.display = 'block';
          toggleChartButton.innerHTML = `<i class="fas fa-chart-line"></i> ÈöêËóèËµ∞ÂäøÂõæ`;
          if (historicalData) {
            renderChart();
          } else if (!loading && !error) {
             statusMessagesDiv.innerHTML += `
              <div class="loading-message">
                <div class="loading-spinner"></div>
                Ê≠£Âú®Âä†ËΩΩËµ∞ÂäøÂõæÊï∞ÊçÆ...
              </div>
            `;
          }
        } else {
          chartContainer.style.display = 'none';
          toggleChartButton.innerHTML = `<i class="fas fa-chart-area"></i> ÊòæÁ§∫ÂéÜÂè≤Ëµ∞Âäø`;
        }
      }

      // Fetch current exchange rate
      async function fetchExchangeRate() {
        error = null;
        exchangeRate = null;
        convertedAmount = null;
        loading = true;
        updateUI();

        try {
          const response = await fetch(`https://api.frankfurter.app/latest?from=${fromCurrency}&to=${toCurrency}`);
          if (!response.ok) {
            throw new Error('Failed to fetch exchange rate');
          }
          const data = await response.json();
          if (data.rates && data.rates[toCurrency]) {
            const rate = data.rates[toCurrency];
            exchangeRate = rate;
            convertedAmount = (amount * rate).toFixed(2);
          } else {
            error = `Êó†Ê≥ïËé∑Âèñ ${fromCurrency} Âà∞ ${toCurrency} ÁöÑÊ±áÁéá„ÄÇ`;
          }
        } catch (err) {
          error = 'Ëé∑ÂèñÊ±áÁéáÊó∂Âá∫ÈîôÔºåËØ∑ÈáçËØï„ÄÇ';
          console.error(err);
        } finally {
          loading = false;
          updateUI();
        }
      }

      // Fetch historical exchange rate data for chart
      async function fetchHistoricalData() {
        const today = new Date();
        const thirtyDaysAgo = new Date(today);
        thirtyDaysAgo.setDate(today.getDate() - 30);

        const formatDate = (date) => date.toISOString().split('T')[0];

        const startDate = formatDate(thirtyDaysAgo);
        const endDate = formatDate(today);

        try {
          const response = await fetch(`https://api.frankfurter.app/${startDate}..${endDate}?from=${fromCurrency}&to=${toCurrency}`);
          if (!response.ok) {
            throw new Error('Failed to fetch historical data');
          }
          const data = await response.json();
          if (data.rates) {
            const labels = Object.keys(data.rates).sort();
            const rates = labels.map(date => data.rates[date][toCurrency]);
            historicalData = { labels, rates };
          }
        } catch (err) {
          console.error('Error fetching historical data:', err);
          historicalData = null; // Clear historical data on error
        } finally {
          updateUI();
        }
      }

      // Render Chart.js chart
      function renderChart() {
        if (currentChart) {
          currentChart.destroy(); // Destroy existing chart instance
        }

        const ctx = historicalChartCanvas.getContext('2d');
        currentChart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: historicalData?.labels || [],
            datasets: [
              {
                label: `${fromCurrency} ‚Üí ${toCurrency}`,
                data: historicalData?.rates || [],
                fill: true,
                backgroundColor: 'rgba(44, 83, 100, 0.1)', /* Darker chart fill */
                borderColor: '#2c5364', /* Darker chart line */
                borderWidth: 3,
                pointBackgroundColor: '#2c5364',
                pointBorderColor: '#e0e0e0',
                pointBorderWidth: 2,
                pointRadius: 4,
                pointHoverRadius: 6,
                tension: 0.4,
                shadowOffsetX: 0,
                shadowOffsetY: 4,
                shadowBlur: 10,
                shadowColor: 'rgba(0, 0, 0, 0.3)', /* Darker shadow */
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: true,
                position: 'top',
                labels: {
                  color: '#e0e0e0', /* Lighter legend text */
                  font: {
                    family: 'Inter',
                    size: 14,
                    weight: '500',
                  },
                  usePointStyle: true,
                  pointStyle: 'circle',
                },
              },
              title: {
                display: true,
                text: `${currencyFlags[fromCurrency]} ${fromCurrency} ‚Üí ${currencyFlags[toCurrency]} ${toCurrency} Ê±áÁéáËµ∞Âäø (ËøáÂéª30Â§©)`,
                color: '#e0e0e0', /* Lighter title text */
                font: {
                  family: 'Inter',
                  size: 16,
                  weight: '600',
                },
                padding: {
                  top: 10,
                  bottom: 30,
                },
              },
              tooltip: {
                backgroundColor: 'rgba(0, 0, 0, 0.9)', /* Darker tooltip background */
                titleColor: '#ffffff',
                bodyColor: '#ffffff',
                borderColor: '#2c5364', /* Darker tooltip border */
                borderWidth: 1,
                cornerRadius: 8,
                displayColors: false,
                callbacks: {
                  title: function(context) {
                    return `Êó•Êúü: ${context[0].label}`;
                  },
                  label: function(context) {
                    return `Ê±áÁéá: ${context.parsed.y.toFixed(4)}`;
                  },
                },
              },
            },
            scales: {
              x: {
                display: true,
                title: {
                  display: true,
                  text: 'Êó•Êúü',
                  color: '#e0e0e0', /* Lighter axis title */
                  font: {
                    family: 'Inter',
                    size: 12,
                    weight: '500',
                  },
                },
                ticks: {
                  color: 'rgba(255, 255, 255, 0.6)', /* Darker ticks */
                  font: {
                    family: 'Inter',
                    size: 11,
                  },
                  maxTicksLimit: 8,
                },
                grid: {
                  color: 'rgba(255, 255, 255, 0.05)', /* Darker grid lines */
                  drawBorder: false,
                },
              },
              y: {
                display: true,
                title: {
                  display: true,
                  text: 'Ê±áÁéá',
                  color: '#e0e0e0', /* Lighter axis title */
                  font: {
                    family: 'Inter',
                    size: 12,
                    weight: '500',
                  },
                },
                ticks: {
                  color: 'rgba(255, 255, 255, 0.6)', /* Darker ticks */
                  font: {
                    family: 'Inter',
                    size: 11,
                  },
                  callback: function(value) {
                    return value.toFixed(4);
                  },
                },
                grid: {
                  color: 'rgba(255, 255, 255, 0.05)', /* Darker grid lines */
                  drawBorder: false,
                },
              },
            },
            interaction: {
              intersect: false,
              mode: 'index',
            },
            elements: {
              point: {
                hoverBackgroundColor: '#ffffff',
                hoverBorderColor: '#2c5364', /* Darker hover border */
                hoverBorderWidth: 3,
              },
            },
          },
        });
      }

      // Event Listeners
      amountInput.addEventListener('input', (e) => {
        amount = parseFloat(e.target.value) || 0;
        if (amount > 0) {
          fetchExchangeRate();
        } else {
          convertedAmount = null;
          exchangeRate = null;
          updateUI();
        }
      });

      fromCurrencySelect.addEventListener('change', (e) => {
        fromCurrency = e.target.value;
        fetchExchangeRate();
        fetchHistoricalData();
      });

      toCurrencySelect.addEventListener('change', (e) => {
        toCurrency = e.target.value;
        fetchExchangeRate();
        fetchHistoricalData();
      });

      swapButton.addEventListener('click', () => {
        const tempFrom = fromCurrency;
        fromCurrency = toCurrency;
        toCurrency = tempFrom;
        fromCurrencySelect.value = fromCurrency;
        toCurrencySelect.value = toCurrency;
        fetchExchangeRate();
        fetchHistoricalData();
      });

      toggleChartButton.addEventListener('click', () => {
        showChart = !showChart;
        updateUI();
        if (showChart && !historicalData) {
          fetchHistoricalData();
        }
      });

      usdCnyButton.addEventListener('click', () => {
        amount = 1;
        fromCurrency = 'USD';
        toCurrency = 'CNY';
        amountInput.value = amount;
        fromCurrencySelect.value = fromCurrency;
        toCurrencySelect.value = toCurrency;
        fetchExchangeRate();
        fetchHistoricalData();
      });

      eurCnyButton.addEventListener('click', () => {
        amount = 1;
        fromCurrency = 'EUR';
        toCurrency = 'CNY';
        amountInput.value = amount;
        fromCurrencySelect.value = fromCurrency;
        toCurrencySelect.value = toCurrency;
        fetchExchangeRate();
        fetchHistoricalData();
      });

      gbpCnyButton.addEventListener('click', () => {
        amount = 1;
        fromCurrency = 'GBP';
        toCurrency = 'CNY';
        amountInput.value = amount;
        fromCurrencySelect.value = fromCurrency;
        toCurrencySelect.value = toCurrency;
        fetchExchangeRate();
        fetchHistoricalData();
      });

      // Initial setup on page load
      document.addEventListener('DOMContentLoaded', () => {
        populateCurrencySelects();
        fetchExchangeRate();
        fetchHistoricalData();
      });
    </script>
  </body>
</html>